var underscore=angular.module("underscore",[]);underscore.factory("_",["$window",function(a){return a._}]),angular.module("DashboardBuilder",["underscore","btford.markdown","schemaForm","Accelerometer","IFrame","Button","Slider","ToggleSwitch","ACL","Grid","Map","Alert","xeditable","ui.bootstrap","ngRoute","slickCarousel","ngAnimate","ngSanitize","WsClient","HttpClient","DataService","Chart","gridster","Gauge","Imagemap","Speedometer","Odometer","SearchBox","ngMaterial","ngMessages","material.svgAssetsCache","Thermometer","angularSpectrumColorpicker","angular-underscore/filters","ui.codemirror","Dygraphs","mgcrea.ngStrap","mgcrea.ngStrap.modal","pascalprecht.translate","ui.select","ui.highlight","mgcrea.ngStrap.select","Display","Plotly","ngSchemaFormFile"]),angular.module("ACL",["ui.bootstrap","List"]),angular.module("ACL").component("scriptrAcl",{bindings:{users:"<?",defaultSetObject:"<?",onSave:"&"},templateUrl:"/UIComponents/dashboard/frontend/components/ACL/ACL.html",controller:["$uibModal",function(a){var b=this;this.$onInit=function(){console.log("$onInit initialized"),b.accessType=1==b.users.length&&"anonymous"==b.users[0].code?"Anonymous access":"Restricted access"},this.$postLink=function(){console.log("$postLink initialized")},this.openModal=function(){a.open({animation:!0,size:"lg",component:"aclPopup",resolve:{widget:function(){return{parent:b,users:b.users,defaultSetObject:b.defaultSetObject,onSave:b.onSave}}}}).result.then(function(a){console.log("selectedItem: "+a)},function(){})}}]}),angular.module("ACL").component("aclPopup",{bindings:{resolve:"<",users:"<?",defaultSetObject:"<?",close:"&",dismiss:"&"},templateUrl:"/UIComponents/dashboard/frontend/components/ACL/myModalContent.html",controller:["$scope","$sce",function(a,b){var c=this;c.listScope,this.$onInit=function(){c.users=c.resolve.widget.users,c.defaultSetObject=c.resolve.widget.defaultSetObject,c.popoverContent=b.trustAsHtml("<span style='color: #323232;'><strong>Scriptr.io provides the following predefined groups:</strong><div class='mt10 mb5'><i class='fa fa-caret-right text-primary'></i> authenticated represents anyone with a valid token.</div><div class='mb5'><i class='fa fa-caret-right text-primary'></i> anonymous represents everyone.</div><div class='mb5'><i class='fa fa-caret-right text-primary'></i> nobody represents no one.</div></span>")},this.onSelect=function(a){c.resolve.modalScope=this,"anonymous"==a.originalObject[this.titleField]&&(this.disableInput=!0,this.hideObjects=!0,c.showMsg=!0)},this.removeAnonymousAccess=function(){c.showMsg=!1,c.resolve.modalScope.disableInput=!1,c.resolve.modalScope.hideObjects=!1;var b=[{code:"anonymous",icon:"fa fa-group"}];a.$broadcast("angucomplete-alt:addObjectToList",c.id,b)},this.addAnonymousAccess=function(){c.showMsg=!1,c.resolve.modalScope.disableInput=!1,c.resolve.modalScope.hideObjects=!1;for(var b=[],d=0;d<c.resolve.modalScope.objects.length;d++)"anonymous"!=c.resolve.modalScope.objects[d].code&&b.push(c.resolve.modalScope.objects[d]);a.$broadcast("angucomplete-alt:addObjectToList",c.id,b)},this.closeAlert=function(){this.show=!1},this.showAlert=function(a,b){this.closeAlert(),this.message={type:a,content:b},this.show=!0},this.updateFileACL=function(){c.listScope||(c.listScope=a.$broadcast("angucomplete-alt:getSetObjects",c.id));var b=c.listScope.targetScope.$$childTail.$ctrl;if("function"==typeof c.resolve.widget.onSave()){var d=[];if(void 0===b.objects&&(b.objects=c.resolve.modalScope.objects),b.objects.length>0)var e=b.objects;else var e=c.resolve.widget.defaultSetObject;for(var f=0;f<e.length;f++)d.push(e[f].code);b.showList=!1,c.resolve.widget.onSave()(d).then(function(a,d){b.showList=!0,c.showAlert("success","The Access Control List is saved successfully."),c.resolve.widget.parent.users=b.objects,c.resolve.widget.parent.accessType=1==b.objects.length&&"anonymous"==b.objects[0].code?"Anonymous access":"Restricted access",console.log("success")},function(a){b.showList=!0,c.showMsg("danger",a.data.response.metadata.errorDetail),console.log("reject",a)})}},this.onCancel=function(a){this.dismiss({$value:"cancel"}),console.log("Dissmisseddd")}}]});const __gridBuildKey__=function(a,b){var c=[];_.forEach(a,function(a){var b={headerName:a,field:a};c.push(b)}),c.length>0?b["columns-definition"]=JSON.stringify(c):b["columns-definition"]=null},__dygraphsChartBuildKey__=function(a,b){for(var c=["#CC5464","#FCC717","#38B9D6","#1DBC68","#E90088","#1B1B1B","#2243B6","#299617","#FF3855","#FFDB00","#AF6E4D","#5946B2","#FF9966","#FF007C","#BFAFB2","#5DADEC","#A7F432","#FA5B3D","#A83731","#9C51B6","#EE34D2","#0A7E8C","#FFD12A","#76D7EA","#84DE02"],d={},e=b["colors-mapping"],f=0;f<e.length;f++)e[f].ykeys&&(d[e[f].ykeys]={labels:e[f].labels,colors:e[f].colors,axisSelection:e[f].axisSelection,unit:e[f].unit});for(var g=[],h=0;h<a.length;h++)if(d[a[h]])g.push({ykeys:a[h],labels:d[a[h]].labels,colors:d[a[h]].colors,axisSelection:d[a[h]].axisSelection,unit:d[a[h]].unit});else{for(var i=0;i<c.length;i++){for(var j=!1,k=c[i],l=0;l<g.length;l++){var m=g[l].colors;if(m==k){j=!0;break}}if(!j)break}g.push({ykeys:a[h],labels:a[h],colors:j?c[0]:c[i],axisSelection:"y",unit:""})}0==g.length&&(g=[{}]),b["colors-mapping"]=g;for(var n='["x",',o='["X",',h=0;h<a.length;h++)n+='"y"'+(h<a.length-1?" , ":""),o+='"'+a[h]+'"'+(h<a.length-1?" , ":"");b["legend-labels"]=o+"]",b["legend-mapping"]=n+"]"},__morrisChartBuildKeys__=function(a,b){for(var c=["#CC5464","#FCC717","#38B9D6","#1DBC68","#E90088","#1B1B1B","#2243B6","#299617","#FF3855","#FFDB00","#AF6E4D","#5946B2","#FF9966","#FF007C","#BFAFB2","#5DADEC","#A7F432","#FA5B3D","#A83731","#9C51B6","#EE34D2","#0A7E8C","#FFD12A","#76D7EA","#84DE02"],d={},e=b.yconfig,f=0;f<e.length;f++)e[f].key&&(d[e[f].key]={label:e[f].label,color:e[f].color,unit:e[f].unit});for(var g=[],h=0;h<a.length;h++)if(d[a[h]])g.push({key:a[h],label:d[a[h]].label,color:d[a[h]].color,unit:d[a[h]].unit});else{for(var i=0;i<c.length;i++){for(var j=!1,k=c[i],l=0;l<g.length;l++){var m=g[l].color;if(m==k){j=!0;break}}if(!j)break}g.push({key:a[h],label:a[h],color:j?c[0]:c[i],unit:""})}0==g.length&&(g=[{}]),b.yconfig=g,b.xkey="creationDate"},__onQueryChange__=function(a,b,c){var d=[],e=[],f=[];_.forEach(a,function(a,b){if(a.sensor&&a.sensor.length>0&&a.device){var c=a.device;_.forEach(a.sensor,function(a){var b=c+"-"+a;-1==e.indexOf(b)&&e.push(b),-1==f.indexOf(a)&&f.push(a)}),d.push({sensor:a.sensor,device:a.device})}}),c["api-params"]=JSON.stringify({query:d,format:c["data-format"]}),"line"!=c["data-format"]&&"area"!=c["data-format"]&&"bar"!=c["data-format"]||__morrisChartBuildKeys__(e,c),"dygraphs"==c["data-format"]&&__dygraphsChartBuildKey__(e,c),"grid"==c["data-format"]&&__gridBuildKey__(f,c)},__onDevicesChange__=function(a,b,c){c.query[b.key[1]].sensor=null,"true"==c["multiple-data-points"]?c.api=JSON.parse(window.localStorage.devicesModel).devicesAttributesHistoryApi:c.api=JSON.parse(window.localStorage.devicesModel).devicesAttributesLatestApi,c.transport="https"},__onAttributesChange__=function(a,b,c,d){c.transport="wss";var e=[],f=[],g=[];_.forEach(c.query,function(c,d){if(d!==b.key[1])e[d]={sensor:c.sensor,device:c.device},_.forEach(c.sensor,function(a){var b=c.device+"-"+a;-1==f.indexOf(b)&&f.push(b),-1==g.indexOf(a)&&g.push(a)});else{var h={sensor:[]};_.forEach(a,function(a){var b=a.device+"-"+a.value;h.sensor.push(a.value),h.device=a.device,-1==f.indexOf(b)&&f.push(b),-1==g.indexOf(a.value)&&g.push(a.value)}),e.push(h)}}),c["api-params"]=JSON.stringify({query:e,format:c["data-format"]}),"line"!=c["data-format"]&&"area"!=c["data-format"]&&"bar"!=c["data-format"]||__morrisChartBuildKeys__(f,c),"dygraphs"==c["data-format"]&&__dygraphsChartBuildKey__(f,c),"grid"==c["data-format"]&&__gridBuildKey__(g,c)};angular.module("DashboardBuilder").constant("common",{docTab:{title:"Documentation",items:[{type:"template",template:"<div><strong>Note:</strong> if you want to use these properities in the onFormatData Function , please note you need to use the camel case instead of the hyphen case <br/><strong>Example:</strong> if the attribute is <i>item-type</i> , use it as <i>self.itemType</i>  </div>"},{key:"docValue",type:"template",template:'<div class="markdown-db"> <div btf-markdown="form.url"> </div> </div>',url:"",testVal:"test"}]},formTab:{title:"Data Model",items:[{type:"tabs",selectedTabIndex:1,htmlClass:"sub-tabs",tabs:[{title:"Devices",condition:"model['multiple-data-points'] == 'true'",items:[{type:"section",htmlClass:"col-xs-12",items:[{htmlClass:"row",key:"query",title:"Select devices & corresponding attributes",startEmpty:!0,onChange:__onQueryChange__,condition:"model['multiple-data-points'] == 'true'",items:[{type:"section",htmlClass:"row",items:[{htmlClass:"col-xs-6",key:"query[].device",type:"uiselect",placeholder:"Select device",options:{closeOnSelect:!0,callback:"loadDevicesCallback",map:{valueProperty:"id",nameProperty:"id"}},onChange:__onDevicesChange__},{htmlClass:"col-xs-6",key:"query[].sensor",type:"uiselectmultiple",placeholder:"Select device attributes",options:{multiple:!0,closeOnSelect:!0,callback:"loadDeviceSensorsCallback",map:{valueProperty:"value",nameProperty:"name",deviceProperty:"device"},filterTriggers:["model.query[form.key[1]].device"],filter:"model.query[form.key[1]].device == item.device"},onChange:__onAttributesChange__}]}]},{htmlClass:"row",key:"query",title:"Select devices & corresponding attributes",startEmpty:!1,add:null,remove:null,onChange:__onQueryChange__,condition:"model['multiple-data-points'] == 'false'",items:[{type:"section",htmlClass:"row",items:[{htmlClass:"col-xs-6",key:"query[].device",type:"uiselect",placeholder:"Select device",options:{closeOnSelect:!0,callback:"loadDevicesCallback",map:{valueProperty:"id",nameProperty:"id"}},onChange:__onDevicesChange__},{htmlClass:"col-xs-6",key:"query[].sensor",type:"uiselectmultiple",placeholder:"Select device attribute",options:{limit:1,closeOnSelect:!0,callback:"loadDeviceSensorsCallback",map:{valueProperty:"value",nameProperty:"name",deviceProperty:"device"},filterTriggers:["model.query[form.key[1]].device"],filter:"model.query[form.key[1]].device == item.device"},onChange:__onAttributesChange__}]}]}]}]},{title:"Advanced",items:[{type:"section",htmlClass:"row",condition:"!model['deactivateExternalDataHandler'] || model['deactivateExternalDataHandler'] == false",items:[{type:"section",htmlClass:"col-xs-7",items:[{key:"dashboard-data-handler"}]},{type:"section",htmlClass:"col-xs-5",condition:"model['dashboard-data-handler'] === true",items:[{key:"service-tag"}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-6",condition:"model['dashboard-data-handler'] === false",items:[{key:"transport",placeholder:" ",type:"strapselect",titleMap:[{value:"wss",name:"wss"},{value:"https",name:"https"}]}]},{type:"section",htmlClass:"col-xs-6",condition:"model.transport == 'wss'",items:[{key:"msg-tag"}]},{type:"section",htmlClass:"col-xs-6",condition:"model.transport == 'https'",items:[{key:"http-method",type:"strapselect",placeholder:" ",destroyStrategy:"remove",titleMap:[{value:"GET",name:"GET"}]},{key:"fetch-data-interval",destroyStrategy:"remove"}]}]},{type:"section",htmlClass:"row",condition:"model['dashboard-data-handler'] === false && (model.transport == 'wss' || model.transport == 'https')",items:[{type:"section",htmlClass:"col-xs-6",items:[{key:"api"}]},{type:"section",htmlClass:"col-xs-6",items:[{key:"api-params"},{key:"use-window-params"}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12 codemirror-small",condition:"model['dashboard-data-handler'] === false && model['transport'] != 'wss' && model['transport'] != 'https' && model['dropdata'] !== true ",items:[{key:"data",type:"codemirror",codemirrorOptions:{styleActiveLine:!0,lineNumbers:!0,lineWrapping:!0,autoCloseBrackets:!0,matchBrackets:!0,theme:"neo",mode:{name:"javascript",json:!0},readOnly:!1,autoRefresh:!0},$parsers:[function(a,b,c,d){return isNaN(a)||"number"!=d.schema.type&&"integer"!=d.schema.type?a:parseInt(a)}],$formatters:[function(a,b,c,d){return isNaN(a)||"number"!=d.schema.type&&"integer"!=d.schema.type?a:a.toString()}]}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12 codemirror-small",items:[{key:"on-format-data",type:"codemirror",codemirrorOptions:{value:"return;",styleActiveLine:!0,lineNumbers:!0,lineWrapping:!0,autoCloseBrackets:!0,matchBrackets:!0,theme:"neo",mode:"javascript",readOnly:!1,autoRefresh:!0}}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:[{type:"help",helpvalue:"<hr>"}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:[{type:"help",helpvalue:'<div class="alert alert-info"><ul><li>Messages published over the subscibe channel need to have the following format in order to be consumed by a widget:<ul><li>{“id”: “&lt;message tag value&gt;”, “result”: “&lt;static data structure&gt;”}</li></ul></li><li>A script would publish a message  over the subscribe channel as follow:<ul><li>publish(“responseChannel”, {“id”: “&lt;message tag value&gt;”, “result”: “&lt;static data structure&gt;”});</li></ul></li><li>Whether https or wss transport is used, Sciptr API should return the static data structure for widget initial load:<ul><li>return &lt;static data structure&gt;;</li></ul></li></ul></div>'}]}]}]}]}]},schemaFields:{"dashboard-data-handler":{title:"The dashboard will handle data sourcing for widget",type:"boolean",default:!1,description:"Dashboard will use the properties in its settings tab to fetch data and will relay it to the widget."},"service-tag":{title:"Data tag",type:"string",description:"The dashboard data source will fetch data for multiple widgets. Set a data tag for the dashboard to propagate to your widget the data object with the data tag as its key. If not set all the data fetched by the dashboard will be relayed to the widget"},api:{title:"Api",type:"string",description:"Name of the scriptr api (script name) responsible for publishing or returning the widget data."},"api-params":{title:"Api params",type:"string",description:"A JSON formatted object containing the parameters to be sent to the scriptr api.","x-schema-form":{type:"textarea",placeholder:"Ex: {'id' : '599865'}"}},"http-method":{title:"Http method",type:"string",description:"Method to be used when calling the scriptr api over https. Default: GET.",default:"GET"},transport:{title:"Transport",type:"string",description:"Protocol used to call the  scriptr api. Use wss for real time communication whenever your widget needs to update its data live by consuming messages published from scriptr over the subscribe channel defined in settings."},"msg-tag":{title:"Message tag",type:"string",description:"The dashboard widgets consume messages published over the subscribe channel defined in dashboard settings. Message tag is an identifier sent as part of the published message. The widget uses it to know which messages to consume or ignore."},"on-format-data":{title:"onFormatData: function(data, widgetInstance) {",default:"return data;",type:"string",description:"}; Callback function called to transform the data returned to widget. If no transformation is needed return data only."},"use-window-params":{title:"Merge Window Params",type:"boolean",default:!1,description:"Merge URL query params with the widget api params."},"fetch-data-interval":{title:"Fetch Interval",type:"number",description:"Data update interval value in seconds.",minimum:15},docValue:{title:"docValue",type:"string",description:""},isDashboard:{title:"Is dashboard?",type:"hidden",default:!1},query:{type:"array",default:[],items:{type:"object",properties:{device:{title:"Device Identifier",type:"string",placeholder:" ",description:"Select device."},sensor:{type:"array",title:"Device Attributes",description:"Select your device attributes",items:{type:"object"}}}}}}}),angular.module("DashboardBuilder").constant("commonAction",{formTab:{title:"Action",items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-6",items:[{key:"action-transport",placeholder:" ",type:"strapselect",titleMap:[{value:"wss",name:"wss"},{value:"https",name:"https"}]}]},{type:"section",htmlClass:"col-xs-6",items:[{key:"action-http-method",type:"strapselect",condition:"model['action-transport'] =='https'",placeholder:" ",titleMap:[{value:"GET",name:"GET"}]}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-6",items:[{key:"action-api"}]},{type:"section",htmlClass:"col-xs-6",items:[{key:"action-api-params"},{key:"action-use-window-params"}]}]}]},schemaFields:{"action-api":{title:"Action api",type:"string",description:"Name of the scriptr api (script name) used for the widget action call."},"action-api-params":{title:"Api params",type:"string",description:"A JSON formatted object containing the parameters to be sent to the scriptr action api.","x-schema-form":{type:"textarea",placeholder:"Ex: {'id' : '599865'}"}},"action-http-method":{title:"Http method",type:"string",description:"Method to be used when calling the scriptr action api over https. Default: GET.",default:"GET"},"action-transport":{title:"Transport",type:"string",description:"Protocol used to call the  scriptr action api. Use wss for real time communication whenever your widget needs to update its data live by consuming messages published from scriptr over the subscribe channel defined in settings."},"action-use-window-params":{title:"Merge Window Params",type:"boolean",default:!1,description:"Merge URL query params with the widget api params."}}}),angular.module("DashboardBuilder").constant("boxStyle",{formTab:{title:"Box Properties",items:[{key:"boxHeader"},{condition:"model.boxHeader === true",key:"boxLabel"}]},schemaFields:{boxLabel:{title:"Box Label",type:"string",description:"Define your widget box title.",maxLength:40},boxHeader:{title:"Has header title",type:"boolean",default:!0,description:"Check to display a chart header title."}}}),angular.module("DashboardBuilder").constant("widgetsConfig",function(){return{defaultWidget:{name:"displaybox"},widgets:[__LINE_DYGRAPH__,__BAR__,__AREA__,__LINE__,__GRID__,__DONUT__,__WINDROSE__,__3DSURFACE__,__MAP__,__GAUGE__,__IMAGEMAP__,__SPEEDOMETER__,__THERMOMETER__,__ODOMETER__,__PROGRESSBAR__,__ACCELEROMETER__,__ALERT__,__DISPLAY_DATA__,__BUTTON__,__TOGGLE_SWITCH__,__SLIDER__,__IFRAME__,__DOTPLOTS__,__HEATMAP__,__BUBBLECHART__,__SCATTERPLOTS__]}}()).constant("widgetsDocs",{default:"/README.md",widgets:{alert:"/UIComponents/dashboard/frontend/components/alert/properties.md",linedygraph:"/UIComponents/dashboard/frontend/components/dygraphs/properties.md",d3surface:"/UIComponents/dashboard/frontend/components/plotly/3dsurface_properties.md",accelerometer:"/UIComponents/dashboard/frontend/components/accelerometer/properties.md",area:"/UIComponents/dashboard/frontend/components/chart/properties.md",bar:"/UIComponents/dashboard/frontend/components/chart/properties.md",button:"/UIComponents/dashboard/frontend/components/button/properties.md",displayData:"/UIComponents/dashboard/frontend/components/displayCount/properties.md",donut:"/UIComponents/dashboard/frontend/components/chart/properties.md",gauge:"/UIComponents/dashboard/frontend/components/gauge/properties.md",grideye:"/UIComponents/dashboard/frontend/components/grideye/properties.md",grid:"/UIComponents/dashboard/frontend/components/grid/properties.md",iframe:"/UIComponents/dashboard/frontend/components/IFrame/properties.md",line:"/UIComponents/dashboard/frontend/components/chart/properties.md",map:"/UIComponents/dashboard/frontend/components/map/properties.md",odometer:"/UIComponents/dashboard/frontend/components/odometer/properties.md",slider:"/UIComponents/dashboard/frontend/components/slider/properties.md",progressbar:"/UIComponents/dashboard/frontend/components/progressbar/properties.md",speedometer:"/UIComponents/dashboard/frontend/components/speedometer/properties.md",thermometer:"/UIComponents/dashboard/frontend/components/thermometer/properties.md",toggleSwitch:"/UIComponents/dashboard/frontend/components/toggleSwitch/properties.md",windrose:"/UIComponents/dashboard/frontend/components/plotly/windrose_properties.md",dotPlots:"/UIComponents/dashboard/frontend/components/plotly/dotPlots_properties.md",heatmap:"/UIComponents/dashboard/frontend/components/plotly/heatmap_properties.md",bubbleChart:"/UIComponents/dashboard/frontend/components/plotly/bubbleChart_properties.md",scatterPlots:"/UIComponents/dashboard/frontend/components/plotly/scatter_properties.md"}});const __defaultsThemeStyles__={light:{dashboard:{"background-type":"solid","background-image":"","background-position":"center","background-repeat":"no-repeat","background-color":"#FFF","background-gradient":"linear-gradient(45deg, rgba(255,255,255,1) 49%, rgba(192,192,192,1) 100%, rgba(128,128,128,1) 100%);",border:!1,"border-color":"#DDD","border-style":"solid","border-width":1,"border-radius":0,"box-shadow":"true","box-shadow-color":"rgba(51, 51, 51, 0.3)"},box:{"background-type":"solid","background-color":"#FFF","background-gradient":"linear-gradient(45deg, rgba(255,255,255,1) 49%, rgba(192,192,192,1) 100%, rgba(128,128,128,1) 100%);",border:!1,"border-color":"#DDD","border-style":"solid","border-width":1,"border-radius":0,"box-shadow":"true","box-shadow-color":"rgba(51, 51, 51, 0.3)"},"box-header":{"background-type":"solid","background-color":"#FFF","background-gradient":"linear-gradient(45deg, rgba(255,255,255,1) 49%, rgba(192,192,192,1) 100%, rgba(128,128,128,1) 100%);",border:!1,"border-color":"#DDD","border-style":"solid","border-width":1,"border-radius":0},"box-content":{"background-type":"solid","background-color":"#FFF","background-gradient":"linear-gradient(45deg, rgba(255,255,255,1) 49%, rgba(192,192,192,1) 100%, rgba(128,128,128,1) 100%);",border:!1,"border-color":"#DDD","border-style":"solid","border-width":1,"border-radius":0},"box-label":{"font-weight":"bold","font-size":17,"text-align":"center",display:"block",color:"#000"}},dark:{dashboard:{"background-type":"solid","background-image":"","background-position":"center","background-repeat":"no-repeat","background-color":"#CCC","background-gradient":"linear-gradient(45deg, rgba(255,255,255,1) 49%, rgba(192,192,192,1) 100%, rgba(128,128,128,1) 100%);",border:!1,"border-color":"#111","border-style":"solid","border-width":1,"border-radius":0,"box-shadow":"true","box-shadow-color":"rgba(51, 51, 51, 0.3)"},box:{"background-type":"solid","background-color":"#CCC","background-gradient":"linear-gradient(45deg, rgba(255,255,255,1) 49%, rgba(192,192,192,1) 100%, rgba(128,128,128,1) 100%);",border:!1,"border-color":"#DDD","border-style":"solid","border-width":1,"border-radius":0,"box-shadow":"true","box-shadow-color":"rgba(51, 51, 51, 0.3)"},"box-header":{"background-type":"solid","background-color":"#CCC","background-gradient":"linear-gradient(45deg, rgba(255,255,255,1) 49%, rgba(192,192,192,1) 100%, rgba(128,128,128,1) 100%);",border:!1,"border-color":"#DDD","border-style":"solid","border-width":1,"border-radius":0},"box-content":{"background-type":"solid","background-color":"#CCC","background-gradient":"linear-gradient(45deg, rgba(255,255,255,1) 49%, rgba(192,192,192,1) 100%, rgba(128,128,128,1) 100%);",border:!1,"border-color":"#DDD","border-style":"solid","border-width":1,"border-radius":0},"box-label":{"font-weight":"bold","font-size":17,"text-align":"center",display:"block",color:"#000"}}};angular.module("DashboardBuilder").constant("dashboardConfig",function(){return{script:{form:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-6",items:[{key:"scriptName",notitle:!0,placeholder:"Script name"}]},{type:"section",htmlClass:"col-xs-6",items:[{key:"image",type:"nwpFileUpload",showProgress:!1,simpleImageUpload:!0,i18n:{add:"Open file browser",preview:"Preview Upload",filename:"File Name",progress:"Progress Status",upload:"Upload",dragorclick:"Drag and drop your file here or click here"},notitle:!0}]}]}],schema:{type:"object",title:"Schema",properties:{scriptName:{type:"string",fieldHtmlClass:"script-name-input"},image:{title:"Image",type:"array",format:"singlefile","x-schema-form":{type:"array"},pattern:{mimeType:"image/*",validationMessage:"Wrong File Type. Allowed types "},maxSize:{maximum:"1MB",validationMessage:"File exceeded allowed size of "}}},required:["scriptName"]}},settings:{label:"Dashboard Configuration",name:"dasboard",defaults:{publishChannel:"requestChannel",subscribeChannel:"responseChannel",theme:"light",style:__defaultsThemeStyles__.light,deactivateExternalDataHandler:!0,devicesListApi:"app/api/getDevices",devicesAttributesHistoryApi:"app/api/getDeviceSensorsHistory",devicesAttributesLatestApi:"app/api/getDeviceSensorsLatest"},form:[{type:"tabs",selectedTabIndex:0,tabs:[{title:"Devices Configuration",items:[{key:"devicesListApi",placeholder:"app/api/getDevices"},{key:"devicesAttributesHistoryApi",placeholder:"app/api/getDeviceSensorsHistory"},{key:"devicesAttributesLatestApi",placeholder:"app/api/getDeviceSensorsLatest"}]},{title:"Channels",items:[{type:"section",htmlClass:"row",items:[{type:"help",helpvalue:"<h5 class='pdr10 pdl10'>Set the communication channels used by the dashboard to send and receive data.</h5><hr/>"},{type:"section",htmlClass:"col-xs-12",items:["publishChannel","subscribeChannel"]}]}]},{title:"Theme",items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:[{type:"section",items:[{key:"theme",htmlClass:"",type:"strapselect",placeholder:" ",titleMap:[{value:"light",name:"Light"},{value:"dark",name:"Dark"}]},{key:"reset",condition:"false",htmlClass:"col-xs-12 col-md-2",type:"button"}]},{type:"tabs",selectedTabIndex:0,htmlClass:"sub-tabs",tabs:[{title:"Dashboard",items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"",items:[{type:"section",htmlClass:"col-xs-12 col-sm-6",items:[{key:"style.dashboard.background-type",type:"strapselect",titleMap:[{value:"solid",name:"Solid"},{value:"gradient",name:"Gradient"},{value:"image",name:"Image"}]}]},{type:"section",htmlClass:"col-xs-12 col-sm-6",condition:"model.style['dashboard'] ['background-type'] === 'solid'",items:[{key:"style.dashboard.background-color",colorFormat:"hex3",spectrumOptions:{showInput:!0,showAlpha:!0,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#ff","##f2f2f2","#2c343a"],["#000"]]}}]},{type:"section",htmlClass:"col-xs-12 col-sm-6",condition:"model.style ['dashboard'] ['background-type'] === 'gradient'",items:[{key:"style.dashboard.background-gradient"}]},{type:"section",htmlClass:"col-xs-12 col-sm-6",condition:"model.style ['dashboard'] ['background-type'] === 'image'",items:[{key:"style.dashboard.background-image"}]}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12 col-sm-3",condition:"model.style ['dashboard'] ['background-type'] === 'image'",items:[{key:"style.dashboard.background-position-x",type:"strapselect",titleMap:[{value:"left",name:"Left"},{value:"right",name:"Right"},{value:"center",name:"Center"}]}]},{type:"section",htmlClass:"col-xs-12 col-sm-3",condition:"model.style ['dashboard'] ['background-type'] === 'image'",items:[{key:"style.dashboard.background-position-y",type:"strapselect",titleMap:[{value:"top",name:"Top"},{value:"bottom",name:"Bottom"},{value:"center",name:"Center"}]}]},{type:"section",htmlClass:"col-xs-12 col-sm-3",condition:"model.style ['dashboard'] ['background-type'] === 'image'",items:[{key:"style.dashboard.background-size",type:"strapselect",titleMap:[{value:"auto",name:"Auto"},{value:"cover",name:"Cover"},{value:"contain",name:"Contain"}]}]},{type:"section",htmlClass:"col-xs-12 col-sm-3",condition:"model.style ['dashboard'] ['background-type'] === 'image'",items:[{key:"style.dashboard.background-repeat",type:"strapselect",titleMap:[{value:"repeat-x",name:"repeat-x"},{value:"repeat-y",name:"repeat-y"},{value:"repeat",name:"repeat"},{value:"space",name:"space"},{value:"round",name:"round"},{value:"no-repeat",name:"no-repeat"}]}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12 col-sm-4",items:[{key:"style.dashboard.border-radius",type:"number"}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12 col-sm-4",items:[{key:"style.dashboard.border"}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12 col-sm-4",items:[{key:"style.dashboard.border-width",condition:"model.style ['dashboard'] ['border'] === true",type:"number"}]},{type:"section",htmlClass:"col-xs-12 col-sm-4",items:[{key:"style.dashboard.border-style",condition:"model.style ['dashboard'] ['border'] === true",type:"strapselect",titleMap:[{value:"dotted",name:"Dotted"},{value:"dashed",name:"Dashed"},{value:"solid",name:"Solid"},{value:"double",name:"Double"},{value:"inset",name:"Inset"},{value:"outset",name:"Outset"}]}]},{type:"section",htmlClass:"col-xs-12 col-sm-4",items:[{key:"style.dashboard.border-color",condition:"model.style ['dashboard'] ['border'] === true",colorFormat:"hex3",spectrumOptions:{showInput:!0,showAlpha:!0,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#ff","##f2f2f2","#2c343a"],["#000"]]}}]}]}]},{title:"Box",items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"",items:[{type:"section",htmlClass:"col-xs-12 col-sm-6",items:[{key:"style.box.background-type",type:"strapselect",titleMap:[{value:"solid",name:"Solid"},{value:"gradient",name:"Gradient"}]}]},{type:"section",htmlClass:"col-xs-12 col-sm-6",condition:"model.style['box'] ['background-type'] === 'solid'",items:[{key:"style.box.background-color",colorFormat:"hex3",spectrumOptions:{showInput:!0,showAlpha:!0,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#ff","##f2f2f2","#2c343a"],["#000"]]}}]},{type:"section",htmlClass:"col-xs-12 col-sm-6",condition:"model.style ['box'] ['background-type'] === 'gradient'",items:[{key:"style.box.background-gradient"}]}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12 col-sm-6",items:[{key:"style.box.box-shadow",type:"strapselect",titleMap:[{value:"true",name:"Show"},{value:"false",name:"Hide"}]}]},{type:"section",htmlClass:"col-xs-12 col-sm-6",condition:"model.style ['box'] ['box-shadow'] === 'true'",items:[{key:"style.box.box-shadow-color",colorFormat:"hex3",spectrumOptions:{showInput:!0,showAlpha:!0,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#ff","##f2f2f2","#2c343a"],["#000"]]}}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12 col-sm-4",items:[{key:"style.box.border-radius",type:"number"}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:["style.box.border"]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12 col-sm-4",items:[{key:"style.box.border-width",condition:"model.style ['box'] ['border'] === true",type:"number"}]},{type:"section",htmlClass:"col-xs-12 col-sm-4",items:[{key:"style.box.border-style",condition:"model.style ['box'] ['border'] === true",type:"strapselect",titleMap:[{value:"dotted",name:"Dotted"},{value:"dashed",name:"Dashed"},{value:"solid",name:"Solid"},{value:"double",name:"Double"},{value:"inset",name:"Inset"},{value:"outset",name:"Outset"}]}]},{type:"section",htmlClass:"col-xs-12 col-sm-4",items:[{key:"style.box.border-color",condition:"model.style ['box'] ['border'] === true",colorFormat:"hex3",spectrumOptions:{showInput:!0,showAlpha:!0,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#ff","##f2f2f2","#2c343a"],["#000"]]}}]}]}]},{title:"Chart Container",items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"",items:[{type:"section",htmlClass:"col-xs-12 col-sm-6",items:[{key:"style.box-content.background-type",type:"strapselect",titleMap:[{value:"solid",name:"Solid"},{value:"gradient",name:"Gradient"},{value:"transparent",name:"Transparent"}]}]},{type:"section",
htmlClass:"col-xs-12 col-sm-6",condition:"model.style ['box-content'] ['background-type'] === 'solid'",items:[{key:"style.box-content.background-color",colorFormat:"hex3",spectrumOptions:{showInput:!0,showAlpha:!0,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#ff","##f2f2f2","#2c343a"],["#000"]]}}]},{type:"section",htmlClass:"col-xs-12 col-sm-6",condition:"model.style ['box-content'] ['background-type'] === 'gradient'",items:[{key:"style.box-content.background-gradient"}]}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12 col-sm-4",items:[{key:"style.box-content.border-radius",type:"number"}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:["style.box-content.border"]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12 col-sm-4",items:[{key:"style.box-content.border-width",condition:"model.style['box-content'] ['border'] === true",type:"number"}]},{type:["section","strapselect"],htmlClass:"col-xs-12 col-sm-4",key:"style.box-content.border-style",condition:"model.style['box-content'] ['border'] === true",titleMap:[{value:"dotted",name:"Dotted"},{value:"dashed",name:"Dashed"},{value:"solid",name:"Solid"},{value:"double",name:"Double"},{value:"inset",name:"Inset"},{value:"outset",name:"Outset"}]},{type:"section",htmlClass:"col-xs-12 col-sm-4",items:[{key:"style.box-content.border-color",condition:"model.style ['box-content'] ['border'] === true",colorFormat:"hex3",spectrumOptions:{showInput:!0,showAlpha:!0,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#ff","##f2f2f2","#2c343a"],["#000"]]}}]}]}]},{title:"Header container",items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12 col-sm-3",items:[{key:"style.box-label.text-align",type:"strapselect",titleMap:[{value:"left",name:"Left"},{value:"center",name:"Center"},{value:"right",name:"Right"}]}]},{type:"section",htmlClass:"col-xs-12 col-sm-3",items:[{key:"style.box-label.font-weight",type:"strapselect",titleMap:[{value:"normal",name:"Normal"},{value:"bold",name:"Bold"}]}]},{type:"section",htmlClass:"col-xs-12 col-sm-3",items:[{key:"style.box-label.font-size",type:"number"}]},{type:"section",htmlClass:"col-xs-12 col-sm-3",items:[{key:"style.box-label.color",colorFormat:"hex3",showInput:!0,showAlpha:!0,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#ff","##f2f2f2","#2c343a"],["#000"]]}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"",items:[{type:"section",htmlClass:"col-xs-12 col-sm-6",items:[{key:"style.box-header.background-type",type:"strapselect",titleMap:[{value:"solid",name:"Solid"},{value:"gradient",name:"Gradient"},{value:"transparent",name:"Transparent"}]}]},{type:"section",htmlClass:"col-xs-12 col-sm-6",condition:"model.style ['box-header'] ['background-type'] === 'solid'",items:[{key:"style.box-header.background-color",colorFormat:"hex3",spectrumOptions:{showInput:!0,showAlpha:!0,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#ff","##f2f2f2","#2c343a"],["#000"]]}}]},{type:"section",htmlClass:"col-xs-12 col-sm-6",condition:"model.style ['box-header'] ['background-type'] === 'gradient'",items:[{key:"style.box-header.background-gradient"}]}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12 col-sm-4",items:[{key:"style.box-header.border-radius",type:"number"}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:[{key:"style.box-header.border"}]}]},{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12 col-sm-4",items:[{key:"style.box-header.border-style",condition:"model.style ['box-header'] ['border'] === true",type:"strapselect",titleMap:[{value:"dotted",name:"Dotted"},{value:"dashed",name:"Dashed"},{value:"solid",name:"Solid"},{value:"double",name:"Double"},{value:"inset",name:"Inset"},{value:"outset",name:"Outset"}]}]},{type:"section",htmlClass:"col-xs-12 col-sm-4",items:[{key:"style.box-header.border-color",condition:"model.style ['box-header'] ['border'] === true",colorFormat:"hex3",spectrumOptions:{showInput:!0,showAlpha:!0,allowEmpty:!0,showPalette:!0,preferredFormat:"hex3",palette:[["#ff","##f2f2f2","#2c343a"],["#000"]]}}]},{type:"section",htmlClass:"col-xs-12 col-sm-4",items:[{condition:"model.style ['box-header'] ['border'] === true",key:"style.box-header.border-width",type:"number"}]}]}]}]}]}]}]},{title:"Style",items:[{type:"section",htmlClass:"row",items:[{type:"section",htmlClass:"col-xs-12",items:[{key:"inline-style",type:"codemirror",codemirrorOptions:{styleActiveLine:!0,lineNumbers:!0,lineWrapping:!0,autoCloseBrackets:!0,matchBrackets:!0,theme:"neo",readOnly:!1,autoRefresh:!0,mode:"css"}}]}]}]}]}],schema:{type:"object",title:"Schema",properties:{publishChannel:{title:"Publish channel",type:"string",description:"Widgets use the publish channel to publish messages that will be distributed to its subscribers."},subscribeChannel:{title:"Subscribe channel",type:"string",description:"Widgets use the subscribe channel to consume the messages published over that channel as a data source."},theme:{title:"Theme",type:"string",description:"Select a dashboard theme. By default, light theme is applied.",default:"light"},reset:{title:"Reset",type:"string",description:"",default:""},style:{title:"Style",type:"object",properties:{dashboard:{title:"Dashboard",type:"object",properties:{"background-type":{title:"Background Type",type:"string",default:"solid"},"background-image":{title:"Background Image URL",type:"string",default:""},"background-position-x":{title:"Position X",type:"string",default:"center"},"background-position-y":{title:"Position Y",type:"string",default:"center"},"background-size":{title:"Background size",type:"string",default:"cover"},"background-repeat":{title:"Repeat",type:"string",default:"no-repeat"},"background-color":{title:"Background Color",type:"string",format:"color",default:"#FFF",validationMessage:"Invalid Color"},"background-gradient":{title:"Background Gradient",type:"string",default:"linear-gradient(45deg, rgba(255,255,255,1) 49%, rgba(192,192,192,1) 100%, rgba(128,128,128,1) 100%);"},border:{title:"Show Border",type:"boolean",default:!1},"border-color":{title:"Border Color",type:"string",format:"color",default:"#DDD"},"border-style":{title:"Border Style",type:"string",default:"solid"},"border-width":{title:"Border width",type:"number",default:1},"border-radius":{title:"Border Radius",type:"number",default:0},"box-shadow":{title:"Show Box Shadow",type:"string",default:"true"},"box-shadow-color":{title:"Box shadow color",type:"string",format:"color",default:"rgba(51, 51, 51, 0.3)"}}},box:{title:"Box",type:"object",properties:{"background-type":{title:"Background Type",type:"string",default:"solid"},"background-color":{title:"Background Color",type:"string",format:"color",default:"#FFF",validationMessage:"Invalid Color"},"background-gradient":{title:"Background Gradient",type:"string",default:"linear-gradient(45deg, rgba(255,255,255,1) 49%, rgba(192,192,192,1) 100%, rgba(128,128,128,1) 100%);"},border:{title:"Show Border",type:"boolean",default:!1},"border-color":{title:"Border Color",type:"string",format:"color",default:"#DDD"},"border-style":{title:"Border Style",type:"string",default:"solid"},"border-width":{title:"Border width",type:"number",default:1},"border-radius":{title:"Border Radius",type:"number",default:0},"box-shadow":{title:"Show Box Shadow",type:"string",default:"true"},"box-shadow-color":{title:"Box shadow color",type:"string",format:"color",default:"rgba(51, 51, 51, 0.3)"}}},"box-header":{title:"Box",type:"object",properties:{"background-type":{title:"Background Type",type:"string",default:"solid"},"background-color":{title:"Background Color",type:"string",format:"color",default:"#FFF",validationMessage:"Invalid Color"},"background-gradient":{title:"Background Gradient",type:"string",default:"linear-gradient(45deg, rgba(255,255,255,1) 49%, rgba(192,192,192,1) 100%, rgba(128,128,128,1) 100%);"},border:{title:"Show Border",type:"boolean",default:!1},"border-color":{title:"Border Color",type:"string",format:"color",default:"#DDD"},"border-style":{title:"Border Style",type:"string",default:"solid"},"border-width":{title:"Border width",type:"number",default:1},"border-radius":{title:"Border Radius",type:"number",default:0}}},"box-content":{title:"Box",type:"object",properties:{"background-type":{title:"Background Type",type:"string",default:"solid"},"background-color":{title:"Background Color",type:"string",format:"color",default:"#FFF",validationMessage:"Invalid Color"},"background-gradient":{title:"Background Gradient",type:"string",default:"linear-gradient(45deg, rgba(255,255,255,1) 49%, rgba(192,192,192,1) 100%, rgba(128,128,128,1) 100%);"},border:{title:"Show Border",type:"boolean",default:!1},"border-color":{title:"Border Color",type:"string",format:"color",default:"#DDD"},"border-style":{title:"Border Style",type:"string",default:"solid"},"border-width":{title:"Border width (px)",type:"number",default:1},"border-radius":{title:"Border Radius (px)",type:"number",default:0}}},"box-label":{title:"Box",type:"object",properties:{"font-weight":{title:"Font weight",type:"string",default:"normal"},"font-size":{title:"Font size",type:"number",default:19},"text-align":{title:"Text Align",type:"string",default:"center"},display:{title:"Display",type:"string",default:"block"},color:{title:"Color",type:"string",format:"color",default:"#000",validationMessage:"Invalid Color"}}}}},"inline-style":{title:"Define your own style",type:"string",description:"ex: .dashboardTheme .dashboardContainer {background-color: red;}"},devicesListApi:{title:"Devices & atttibutes list api",type:"string",default:"app/api/getDevices",description:"Name of the scriptr api (script name) responsible for publishing or returning the devices list and their corresponding attributes."},devicesAttributesHistoryApi:{title:"Devices historical data api",type:"string",default:"app/api/getDeviceSensorsHistory",description:"Name of the scriptr api (script name) responsible for publishing or returning the devices attributes historical data."},devicesAttributesLatestApi:{title:"Devices latest data api",type:"string",default:"app/api/getDeviceSensorsLatest",description:"Name of the scriptr api (script name) responsible for publishing or returning the devices attributes latest data."}},required:["publishChannel","subscribeChannel"]}}}}()),angular.module("DashboardBuilder").component("dashboardsList",{bindings:{dashboard:"<"},templateUrl:"/UIComponents/dashboardBuilder/javascript/components/dashboardsList.html",controller:["$scope","$timeout","$sce","$window","httpClient","wsClient","$cookies","$uibModal","scriptrService","$route","$routeParams","$q","_",function(a,b,c,d,e,f,g,h,i,j,k,l,m){this.wsClient=f;var n=this;n.acls,this.$onInit=function(){n.loading=!0,n.showPanelMsg=!1,n.users=[{code:"anonymous",icon:"fa fa-group"}],this.urlParams=[],this.transport={},this.frmGlobalOptions={destroyStrategy:"remove",formDefaults:{feedback:!0}};var a=k.scriptName;a&&this.openEditor(a)},this.$postLink=function(){i.loadDashboards({}).then(function(a,b){a&&a.documents?(n.customDashboards=a.documents,n.loading=!1,0==a.documents.length&&(n.noDashboards=!0)):(console.log("No dashboard found."),n.loading=!1)},function(a){n.loading=!1,console.log("reject published promise",a)})},this.deleteDashboardConfirmation=function(a,b){h.open({controller:"PopupCont",templateUrl:"/UIComponents/dashboardBuilder/javascript/components/deletePopup.html",resolve:{dashboard:function(){return n},path:function(){return a},name:function(){return b}}})},this.deleteDashboard=function(a){var b={path:a,name:name};n=this,i.deleteDashboard(b).then(function(a,b){console.log("Delete success."),a&&a.documents?(n.customDashboards=a.documents,0==a.documents.length?n.noDashboards=!0:n.noDashboards=!1,n.showMsg("success","The dashboard has been deleted successfully.")):a&&a.errorDetail?n.showMsg("danger",a.errorDetail):n.showMsg("danger","An error has occured")},function(a){n.showMsg("danger","An error has occured"),console.log("reject published promise",a)})},this.renameDashboard=function(a,b){var c=l.defer();if(console.log(a,b),a!=b){var d={scriptName:a,newScriptName:b},e=this;return console.log(d),i.renameDashboard(d).then(function(a,b){a&&a.documents?(e.customDashboards=a.documents,0==a.documents.length?e.noDashboards=!0:e.noDashboards=!1,c.resolve(),e.showMsg("success","The dashboard has been renamed successfully.")):(c.reject(),a&&a.errorDetail?e.showMsg("danger",a.errorDetail):e.showMsg("danger","An error has occured"))},function(a){c.reject(),e.showMsg("danger",a.data.response.metadata.errorDetail),console.log("reject published promise",a)}),c.promise}},this.closeAlert=function(){this.show=!1},this.showAlert=function(a,b){this.closeAlert(),this.message={type:a,content:b},this.show=!0},this.closeMsg=function(){this.showPanelMsg=!1},this.showMsg=function(a,b){this.closeMsg(),this.message={type:a,content:b},this.showPanelMsg=!0},this.openEditor=function(a){this.model={scriptName:a};var b=this;i.getScript(this.model).then(function(c,d){b.postLoadScript(a,c)},function(a){console.error("reject",a)})}}]}),angular.module("DashboardBuilder").controller("PopupCont",["$scope","$uibModalInstance",function(a,b){a.name=a.$resolve.name,a.close=function(){b.dismiss("cancel")},a.ondeleteDashboard=function(){this.$resolve.dashboard.deleteDashboard(this.$resolve.path),b.dismiss("cancel")}}]),angular.module("DashboardBuilder").service("scriptrService",["httpClient","$cookies",function(a,b){this.saveScript=function(b,c){return a.post("UIComponents/dashboardBuilder/backend/api/saveDashboard",b)},this.getScript=function(b){return a.post("UIComponents/dashboardBuilder/backend/api/getDashboard",b)},this.loadDashboards=function(b){return a.get("UIComponents/dashboardBuilder/backend/api/loadScripts",{})},this.deleteDashboard=function(b){return a.get("UIComponents/dashboardBuilder/backend/api/deleteDashboard",b)},this.renameDashboard=function(b){return a.get("UIComponents/dashboardBuilder/backend/api/renameDashboard",b)},this.getToken=function(){return b.get("token")||null}}]),angular.module("DashboardBuilder").component("dashboard",{bindings:{widgets:"<",dashboard:"<",treeSearchCriteria:"@",iconExpand:"@",iconCollapse:"@",loadTree:"<?"},templateUrl:"/UIComponents/dashboardBuilder/javascript/components/dashboard.html",controller:["$scope","$rootScope","$timeout","$interval","$sce","$window","httpClient","wsClient","$cookies","common","commonAction","widgetsConfig","widgetsDocs","$uibModal","scriptrService","$route","$routeParams","$q","_","boxStyle","dashboardConfig","dataService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){b.isMobileDevice=function(){return void 0!==window.orientation||-1!==navigator.userAgent.indexOf("IEMobile")},this.wsClient=h;var w=this;w.acls,w.counter=0,b.loadDevices=function(){var b={api:w.dashboardSettings.defaults.devicesListApi,transport:"https",httpMethod:"GET",widgetId:a.$id};v.scriptrRequest(b,function(a,b){window.localStorage.setItem("devices",JSON.stringify(a))})},this.setDevicesModelProperties=function(a){var b={};b.devicesListApi=a.devicesListApi,b.devicesAttributesHistoryApi=a.devicesAttributesHistoryApi,b.devicesAttributesLatestApi=a.devicesAttributesLatestApi,window.localStorage.setItem("devicesModel",JSON.stringify(b))},this.$onInit=function(){w.loadTree=void 0===this.loadTree||this.loadTree,w.loading=!0,w.showPanelMsg=!1,w.users=[{code:"anonymous",icon:"fa fa-group"}],w.setDevicesModelProperties({devicesListApi:"app/api/getDevices",devicesAttributesHistoryApi:"app/api/getDevicesSensorsHistory",devicesAttributesLatestApi:"app/api/getDeviceSensorsLatest"}),w.onACLChange=function(a){w.acls=a.join(";");var b=r.defer();return w.saveScript(null,null,!0).then(function(a,c){console.log("success"),b.resolve(a,c)},function(a){console.log("reject",a),b.reject(a)}),b.promise},this.urlParams=[],this.dashboardSettings=angular.copy(u.settings),this.frmGlobalOptions={destroyStrategy:"remove",formDefaults:{feedback:!0}},this.initializeDashboard(),this.schema=angular.copy(u.script.schema),this.form=angular.copy(u.script.form),this.model={},this.isInIde=!!q.scriptrIdeRef;var d=q.scriptName;d?this.openEditor(d):b.loadDevices(),this.slickConfig={enabled:!0,autoplay:!0,draggable:!1,autoplaySpeed:3e3,method:{},event:{beforeChange:function(a,b,c,d){},afterChange:function(a,b,c,d){}}},this.gridsterOptions={defaultSizeY:50,defaultSizeX:50,minRows:1,maxRows:100,columns:10,colWidth:"auto",rowHeight:"50",margins:[10,10],defaultSizeX:2,defaultSizeY:1,mobileBreakPoint:480,minColumns:1,sparse:!1,resizable:{enabled:!0,handle:".my-class",start:function(a,b,c){$(window).trigger("resize")},resize:function(a,b,c){$(window).trigger("resize")},stop:function(a,b,d){console.log("End resize:",a,b,d),c(function(){$(window).trigger("resize")},100),w.notifyDashboardChange()}},draggable:{enabled:!0,handle:".drag-box",start:function(a,b,c){setTimeout(function(){$(window).trigger("resize"),window.dispatchEvent(new Event("resize"))},100)},drag:function(a,b,c){setTimeout(function(){$(window).trigger("resize"),window.dispatchEvent(new Event("resize"))},100)},stop:function(a,b,c){setTimeout(function(){$(window).trigger("resize"),window.dispatchEvent(new Event("resize"))},100),w.notifyDashboardChange()}}},a.$watch("self.dashboard.widgets",function(a){},!0),a.$on("gridster-resized",function(a,b,c){$(window).trigger("resize")}),a.$on("gridster-item-initialized",function(a){$(window).trigger("resize")}),this.widgetsConfig=l.widgets,this.widgetsCommon=j,this.widgetsCommonAction=k,this.dataLoaded=!0},this.$postLink=function(){var a=this;this.scriptrIdeRef=q.scriptrIdeRef,angular.element(f).on("message",function(b){var c=b.originalEvent.data;c[0]=="get_editor_save_data-"+a.scriptrIdeRef&&f.parent&&f.parent.postMessage(["editor_save-"+a.scriptrIdeRef,a.getEditorValue()],"*"),c[0]=="set_editor_load_data-"+a.scriptrIdeRef&&a.setEditorValue(JSON.parse(c[1]))}),f.parent&&f.parent.postMessage(["editor_loaded-"+this.scriptrIdeRef],"*")},this.trustSrc=function(a){return e.trustAsResourceUrl(a)},this.openEditor=function(a){this.model={scriptName:a};var b=this;o.getScript(this.model).then(function(c,d){b.postLoadScript(a,c)},function(a){console.error("reject",a)})},this.initializeDashboard=function(){a.$on("waiting-for-data",function(){w.consumeData(w.data)}),this.dashboard={widgets:[]},this.widgets&&(this.dashboard.widgets=this.widgets)},this.getDocsURL=function(a){return m.widgets[a]?m.widgets[a]:m.default},this.postLoadScript=function(a,c){var d=/\/\*#\*SCRIPTR_PLUGIN\*#\*(.*\n?.*)\*#\*#\*\//;if(!c)return this.showAlert("danger","Invalid dashboard script. Pass another script."),void console.error("Invalid dashboard script. Pass another script.");var e=c.userConfig,f=e.match(d);if(e&&f){var g=JSON.parse(f[1]);if(g&&g.metadata&&"DashboardBuilder"==g.metadata.name){this.widgets=[];var h=JSON.parse(g.metadata.plugindata).wdg;s.map(h,function(a,b){a.schema&&a.form&&(a.sizeX=2*a.sizeX,a.sizeY=3*a.sizeY,a.col=2*a.col,a.row=3*a.row);var c=s.findWhere(w.widgetsConfig,{name:a.name}),d=angular.copy(c.form),e=angular.copy(c.schema);angular.copy(c.defaults);c.box&&c.box.fitToWidget&&!a.fitToWidget&&(a.fitToWidget=c.box.fitToWidget),c.commonActionData&&(d[0].tabs=angular.copy([k.formTab].concat(d[0].tabs)),e.properties=F(e.properties,k.schemaFields)),c.commonData&&(d[0].tabs=angular.copy([j.formTab].concat(d[0].tabs)),e.properties=F(j.schemaFields,e.properties)),d[0].tabs=angular.copy(d[0].tabs.concat(t.formTab)),e.properties=F(e.properties,t.schemaFields);var f=angular.copy(j.docTab);f.items[1].url=w.getDocsURL(a.name),d[0].tabs=angular.copy(d[0].tabs.concat(f)),d[0].selectedTabIndex=0,a.form=angular.copy(d),a.schema=angular.copy(e),w.isManualAdd=!1,w.widgets.push(a)}),this.urlParams=JSON.parse(g.metadata.plugindata).urlParams,this.dashboardSettings.defaults=JSON.parse(g.metadata.plugindata).settings,b.loadDevices(),this.initDashboardDataService();var i=A(this.dashboardSettings.defaults);B(i),this.dashboard.widgets=this.widgets,this.isEdit=!0,this.savedScript=a,this.setACLs(c)}else this.showAlert("danger","Invalid dashboard script. Pass another script."),console.error("Invalid dashboard script. Pass another script.")}else this.showAlert("danger","Invalid dashboard script. Pass another script."),console.error("Invalid dashboard script. Pass another script.");console.debug("resolve get script "+a+" :",c)},this.clear=function(){var b=this;n.open({animation:!0,component:"confirmationModal",size:"md",scope:a,resolve:{data:function(){return{title:"Clear Board",body:"Are you sure you want to empty your dashboard?"}}}}).result.then(function(a){a&&b.clearWidgets()},function(){console.info("modal-component for clearing dashboard update dismissed at: "+new Date)})},this.clearWidgets=function(){this.dashboard.widgets=[],this.notifyDashboardChange()},this.logout=function(){$.scriptr.authorization({loginPage:login.loginTarget}).logout()},this.addWidget=function(a){var b=angular.copy(a.form),c=angular.copy(a.schema);a.commonActionData&&(b[0].tabs=angular.copy([k.formTab].concat(b[0].tabs)),c.properties=F(c.properties,k.schemaFields)),a.commonData&&(b[0].tabs=angular.copy([j.formTab].concat(b[0].tabs)),c.properties=F(j.schemaFields,c.properties)),b[0].tabs=angular.copy(b[0].tabs.concat(t.formTab)),c.properties=F(c.properties,t.schemaFields);var d=angular.copy(j.docTab);d.items[1].url=this.getDocsURL(a.name),b[0].tabs=angular.copy(b[0].tabs.concat(d)),b[0].selectedTabIndex=0;var e=angular.copy(a.defaults);null!=w.dashboardSettings.defaults.transport&&(e["dashboard-data-handler"]=!0,e["msg-tag"]=null,e.transport=null,e.api=null,e.data=null),this.dashboard.widgets.push({name:a.name,sizeX:a.box&&a.box.sizeX?a.box.sizeX:2,sizeY:a.box&&a.box.sizeY?a.box.sizeY:2,minSizeX:a.box&&a.box.minSizeX?a.box.minSizeX:2,maxSizeX:a.box&&a.box.maxSizeX?a.box.maxSizeX:null,minSizeY:a.box&&a.box.minSizeY?a.box.minSizeY:2,maxSizeY:a.box&&a.box.maxSizeY?a.box.maxSizeY:null,fitToWidget:a.box&&a.box.fitToWidget?a.box.fitToWidget:null,label:a.label,type:a.class,options:e,schema:c,form:b}),this.isManualAdd=!0,this.notifyDashboardChange()};var x=function(a){angular.element(document.querySelector("#dashboardInlineStyle"))[0].innerText=a},y=function(a){angular.element(document.querySelector("#dashboardPreviewInlineStyle"))[0].innerText=a},z=function(){angular.element(document.querySelector("#dashboardPreviewInlineStyle"))[0].innerText=""};this.cancelDashboardDataService=function(){var b=this.dashboardSettings.defaults["msg-tag"];console.log("destory dashboard data service",b,a.$id),b&&h.unsubscribe(b,null,a.$id),w.refreshDataTimer&&d.cancel(w.refreshTimer)},this.data=null,this.consumeData=function(b,c){w.data=b,a.$broadcast("update-data",b)},this.$onDestroy=function(){w.resetDashboardDataService()},this.resetDashboardDataService=function(){console.log("destory dashboard data service props",w.dashboardSettings.defaults["msg-tag"],a.$id),w.dashboardSettings.defaults["msg-tag"]&&h.unsubscribe(w.dashboardSettings.defaults["msg-tag"],null,a.$id),w.refreshTimer&&d.cancel(w.refreshTimer)},this.initDashboardDataService=function(){if(w.dashboardSettings.defaults.transport){var b={api:w.dashboardSettings.defaults.api,transport:w.dashboardSettings.defaults.transport,msgTag:w.dashboardSettings.defaults["msg-tag"],apiParams:w.dashboardSettings.defaults["api-params"],useWindowParams:w.dashboardSettings.defaults["use-window-params"],httpMethod:w.dashboardSettings.defaults["http-method"],widgetId:a.$id};v.scriptrRequest(b,w.consumeData.bind(w)),null!=w.dashboardSettings.defaults["fetch-data-interval"]&&null==w.refreshTimer&&(w.refreshTimer=d(function(){w.initDashboardDataService()},1e3*w.dashboardSettings.defaults["fetch-data-interval"]))}},this.setDashboardSettings=function(a){var b=this,c=b.dashboardSettings.defaults.theme,d=b.dashboardSettings.defaults.theme,e=(b.dashboardSettings.defaults["inline-style"],b.dashboardSettings.defaults["inline-style"],angular.copy(b.dashboardSettings.form)),f=angular.copy(b.dashboardSettings.schema);e[0].tabs=angular.copy([j.formTab].concat(e[0].tabs)),f.properties=F(f.properties,j.schemaFields);var g=angular.copy(j.docTab);g.items[0].url=this.getDocsURL(b.dashboardSettings.name),e[0].tabs=angular.copy(e[0].tabs.concat(g)),n.open({animation:!0,component:"modalComponent",size:"md",resolve:{widget:function(){return{label:b.dashboardSettings.label,options:b.dashboardSettings.defaults,schema:f,form:e,onFormModelChange:function(a,b,d){"theme"===b.key.join(".")&&(d.style=angular.copy(__defaultsThemeStyles__[a]));var e=A(d);C(e),c!=d.theme&&(E(c,d.theme),c=d.theme),d["inline-style"]&&y(d["inline-style"])}}}}}).result.then(function(a){if(console.log("modal-component dashboard settings data :",a,"submitted at: "+new Date),"cancel"!=a){b.dashboardSettings.defaults&&b.dashboardSettings.defaults.publishChannel!=a.publishChannel&&b.wsClient.updatePublishingChannel(a.publishChannel),b.dashboardSettings.defaults&&b.dashboardSettings.defaults.subscribeChannel!=a.subscribeChannel&&b.wsClient.updateSubscriptionChannel(a.subscribeChannel),b.dashboardSettings.defaults=angular.copy(a),b.setDevicesModelProperties({devicesListApi:b.dashboardSettings.defaults.devicesListApi,devicesAttributesHistoryApi:b.dashboardSettings.defaults.devicesAttributesHistoryApi,devicesAttributesLatestApi:b.dashboardSettings.defaults.devicesAttributesLatestApi});var e=A(a);B(e),a["inline-style"]&&x(a["inline-style"]),b.notifyDashboardChange()}else c!=d&&E(c,d);b.resetDashboardDataService(),b.initDashboardDataService(),D(),z()},function(){D(),z(),c!=d&&E(c,d),console.log("modal-component dashboard settings dismissed at: "+new Date)})};var A=function(a){var b=document.querySelector("#handlebar-customcss-template").innerText;return Handlebars.compile(b)(a)},B=function(a){angular.element(document.querySelector("#dashboardCustomStyle"))[0].innerText=a},C=function(a){angular.element(document.querySelector("#dashboardPreviewCustomStyle"))[0].innerText=a},D=function(){angular.element(document.querySelector("#dashboardPreviewCustomStyle"))[0].innerText=""},E=function(a,b){var c=document.getElementsByTagName("link").namedItem(a),b=document.getElementsByTagName("link").namedItem(b);b.disabled=!1,c.disabled=!0};this.saveDashboard=function(b,c,d){console.log("Form submit",b);var e=this;if(a.$broadcast("schemaFormValidate"),b&&b.$valid||d){var f={},g=angular.copy(this.dashboard.widgets);f.items=s.map(g,function(a,b){return s.omit(a,["form","schema"])}),f.urlParams=angular.copy(this.urlParams),f.token=o.getToken(),e.dashboardSettings.defaults.redirectTarget=this.model.scriptName,console.log("dashboardSettings",e.dashboardSettings),f.dashboardSettings=angular.copy(this.dashboardSettings.defaults),f.compiledCss=A(f.dashboardSettings);var h=this.unsafe_tags(document.querySelector("#handlebar-template").innerHTML),i=Handlebars.compile(h)(f),j={};j.content=i,j.scriptName=this.model.scriptName,j.pluginData=JSON.stringify({wdg:f.items,urlParams:f.urlParams,settings:f.dashboardSettings}),e.isEdit&&(j.update=!0),e.savedScript&&(j.previousScriptName=e.savedScript),j.acls=this.acls;var k=r.defer();return o.saveScript(j).then(function(a,b){console.log("resolve",a),"failure"==a.status?e.showAlert("danger",a.errorDetail):(e.isEdit=!0,e.savedScript=j.scriptName,e.showAlert("success","The dashboard has been saved successfully."),k.resolve(a,b))},function(a){e.showAlert("danger",a.data.response.metadata.errorDetail),console.log("reject",a.data.response.metadata.errorDetail),k.reject(a)}),k.promise}},this.setACLs=function(a){this.acls=a.ACL.execute;var b=this.acls.split(";");this.users=[];for(var c=0;c<b.length;c++){var d={};d.code=b[c],this.users.push(d)}},this.selectBranch=function(a){console.log("Clicked branch data",a);var b=a.label;if(a[b]&&a[b].widget&&a[b].widget.type){var c=a[b].widget,d=s.findWhere(l.widgets,{name:c.type});console.log("Widget is",d),d||(d=s.findWhere(l.widgets,{name:l.defaultWidget.name}));var e=angular.copy(d.form),f=angular.copy(d.schema);d.commonActionData&&(e[0].tabs=angular.copy([k.formTab].concat(e[0].tabs)),f.properties=F(f.properties,k.schemaFields)),d.commonData&&(e[0].tabs=angular.copy([j.formTab].concat(e[0].tabs)),f.properties=F(j.schemaFields,f.properties)),e[0].tabs=angular.copy(e[0].tabs.concat(t.formTab)),f.properties=F(f.properties,t.schemaFields);var g=angular.copy(j.docTab);g.items[1].url=this.getDocsURL(d.name),e[0].tabs=angular.copy(e[0].tabs.concat(g)),e[0].selectedTabIndex=0;var h=0;c["default-api-params"]&&(h=Object.keys(c["default-api-params"]).length);var i={};s.each(c,function(a,b){i[b]=a});var m="{";if(c["api-params-name"]&&s.each(c["api-params-name"],function(a,b){w.urlParams=w.urlParams.concat([a]),m+='"'+a+'": vm.'+a+(b<c["api-params-name"].length-1||h>0?",":"")}),c["default-api-params"]){var n=0;s.each(c["default-api-params"],function(a,b){w.urlParams=w.urlParams.concat([b]),m+='"'+b+'": "'+a+(n<h-1?'",':'"'),n++}),m+="}"}else m+="}";console.log("apiParamsOutput",m),i["api-params"]=m,w.dashboard.widgets.push({name:a.label,sizeX:d.box&&d.box.sizeX?d.box.sizeX:2,sizeY:d.box&&d.box.sizeY?d.box.sizeY:2,minSizeX:d.box&&d.box.minSizeX?d.box.minSizeX:2,maxSizeX:d.box&&d.box.maxSizeX?d.box.maxSizeX:null,minSizeY:d.box&&d.box.minSizeY?d.box.minSizeY:2,maxSizeY:d.box&&d.box.maxSizeY?d.box.maxSizeY:null,fitToWidget:d.box&&d.box.fitToWidget?d.box.fitToWidget:null,label:d.label,type:d.class,options:angular.extend(angular.copy(d.defaults),angular.copy(i)),schema:f,form:e}),w.notifyDashboardChange()}},this.addCustomDashboard=function(){this.showDashboard=!0,w.savedScript=null,this.switchStatus=!0,this.model.scriptName=null,w.isEdit=!1,this.dashboard.widgets=[]},this.showCustomDashboard=function(a){this.showDashboard=!0,this.scriptName=a,this.switchStatus=!1,this.dashboardScriptName="/"+this.scriptName,this.openEditor(a)},this.homeCallback=function(a){a&&a.documents?(w.customDashboards=a.documents,0==a.documents.length?w.noDashboards=!0:w.noDashboards=!1):console.log("No data found")},this.deleteDashboard=function(a){console.log(name,a);var b={path:a,name:name};w=this,g.get("UIComponents/dashboardBuilder/backend/api/deleteDashboard",b).then(function(a,b){console.log("success")},function(a){console.log("reject published promise",a)})},this.deleteDashboardPopUp=function(a,b){n.open({controller:"PopupCont",templateUrl:"/UIComponents/dashboardBuilder/javascript/components/deletePopup.html",resolve:{dashboard:function(){return w},path:function(){return a},name:function(){return b}}})},this.renameDashboard=function(a,b){var c=b.split("/");if(c[c.length-1]!=a){console.log(name,b);var d={path:b,newName:a},e=this;g.get("UIComponents/dashboardBuilder/backend/api/renameDashboard",d).then(function(a,b){"success"==a?(console.log("success"),e.showMsg("success","The dashboard has been renamed successfully.")):a&&a.errorDetail?e.showMsg("danger",a.errorDetail):e.showMsg("danger","An error has occured")},function(a){e.showMsg("danger",a.data.response.metadata.errorDetail),console.log("reject published promise",a)})}},this.viewDasboard=function(){this.savedScript?f.open("/"+this.savedScript):w.showAlert("danger","Please save your dashboard before viewing it")},this.closeAlert=function(){this.show=!1},this.showAlert=function(a,b){this.closeAlert(),this.message={type:a,content:b},this.show=!0},this.closeMsg=function(){this.showPanelMsg=!1},this.showMsg=function(a,b){this.closeMsg(),this.message={type:a,content:b},this.showPanelMsg=!0},this.getEditorValue=function(){var a={};a.items=angular.copy(this.dashboard.widgets),a.urlParams=angular.copy(this.urlParams),a.dashboardSettings=angular.copy(this.dashboardSettings.defaults),a.staticdomain=q.staticdomain;var b=this.unsafe_tags(document.querySelector("#handlebar-template").innerHTML),c=Handlebars.compile(b)(a),d={};return d.content=c,d.pluginData=JSON.stringify({wdg:a.items,
urlParams:a.urlParams,settings:a.dashboardSettings}),d},this.setEditorValue=function(a){a&&(this.widgets=a.wdg,this.urlParams=a.urlParams,this.dashboardSettings.defaults=a.settings,this.dashboard.widgets=this.widgets)},this.notifyDashboardChange=function(){f.parent&&f.parent.postMessage(["editor_data_changed-"+this.scriptrIdeRef,this.getEditorValue()],"*")};var F=function(a,b){var c={};for(var d in a)c[d]=a[d];for(var d in b)c[d]=b[d];return c};this.safe_tags=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},this.unsafe_tags=function(a){return a.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"')}}]}),angular.module("DashboardBuilder").component("box",{require:{parent:"^^dashboard"},bindings:{widget:"<"},templateUrl:"/UIComponents/dashboardBuilder/javascript/components/box.html",controller:["$rootScope","$scope","$compile","$element","$uibModal","dataService",function(a,b,c,d,e,f){var g=this;g.isMobile=a.isMobileDevice(),this.remove=function(a){var c=this;e.open({animation:!0,component:"confirmationModal",size:"md",scope:b,resolve:{data:function(){return{title:"Remove Widget",body:"Are you sure you want to remove widget from dashboard?"}}}}).result.then(function(b){b&&c.removeWidget(a)},function(){console.info("modal-component for removing widget dismissed at: "+new Date)})},this.removeWidget=function(a){delete this[a.formatFunction],this.parent.dashboard.widgets.splice(this.parent.dashboard.widgets.indexOf(a),1),this.parent.notifyDashboardChange()},this.$onInit=function(){b.$on("gridster-item-transition-end",function(a){setTimeout(function(){$(window).trigger("resize"),window.dispatchEvent(new Event("resize"))},100)}),b.$on("gridster-item-resized",function(a){setTimeout(function(){$(window).trigger("resize"),window.dispatchEvent(new Event("resize"))},100)});var a=this;this.widget&&this.addWidget(this.widget),b.$on("resize_widget",function(b,c){if(setTimeout(function(){$(window).trigger("resize"),window.dispatchEvent(new Event("resize"))},100),a.widget==c.element&&"scriptr-grid"==a.widget.type){var e=c.wdg.height();c.element.options["grid-height"]=e-110,a.updateWidget(c.element.options)}this.boxWidth=d.width(),g.parent.notifyDashboardChange()}),b.$on("drag_widget",function(a,b){g.parent.notifyDashboardChange()})},this.openSettings=function(){var a=this;e.open({animation:!0,component:"modalComponent",size:"lg",scope:b,resolve:{widget:function(){return a.widget}}}).result.then(function(b){"cancel"!=b&&a.updateWidget(b)},function(){console.info("modal-component for widget update dismissed at: "+new Date)})},this.addWidget=function(a){var e=this;this.chart=angular.element(document.createElement(a.type)),angular.forEach(a.options,function(b,c){if(angular.isArray(b)||angular.isObject(b))e.chart.attr(c,JSON.stringify(b));else if("on-format-data"==c){this.parent.dashboard.counter||(this.parent.dashboard.counter=0),this.parent.dashboard.counter+=1;var d=this.parent.dashboard.counter,f=a.name+"FormatData"+d;e[f]=new Function("data","self",b),a.formatFunction=f,a.formatFunctionValue=b,e.chart.attr("on-format-data","$ctrl."+f)}else e.chart.attr(c,b);if("default-info-window"==c){this.parent.dashboard.counter+=1;var d=this.parent.dashboard.counter,g=angular.element(document.createElement("info-window"));g.attr("id",b.id),g.attr("template",b.template),g.attr("max-width",b["max-width"]),g.attr("max-height",b["max-height"]),e.chart.append(g)}"source-info-window"==c&&angular.forEach(b,function(a,b){var c=angular.element(document.createElement("info-window"));c.attr("id","infoWindowTemplate_"+a.source),c.attr("template",a.template),c.attr("max-width",a["max-width"]),c.attr("max-height",a["max-height"]),e.chart.append(c)})},this);var f=c(this.chart)(b),g=angular.element(d.find(".box-content"));g.append(f),e.parent.isManualAdd&&setTimeout(function(){var a=g.offset().top,b=g.offset().top+g.outerHeight(!0),c=$(window).scrollTop()+window.innerHeight,d=$(window).scrollTop();c>a&&d<b||$("body").animate({scrollTop:g.offset().top+$(g.children()[0]).outerHeight(!0)},100)},200)},this.updateWidget=function(a){var b=this;angular.forEach(a,function(a,c){angular.isArray(a)||angular.isObject(a)?b.chart.attr(c,JSON.stringify(a)):"on-format-data"==c?(b[b.widget.formatFunction]=new Function("data",a),b[b.widget.formatFunctionValue]=a,b.chart.attr("on-format-data","$ctrl."+b.widget.formatFunction)):b.chart.attr(c,a)},this);var c=angular.copy(a),d=this.parent.dashboard.widgets.indexOf(this.widget),e=angular.copy(this.widget);e.options=angular.copy(c),this.parent.dashboard.widgets.splice(d,1,e),this.parent.notifyDashboardChange()}}]}),angular.module("DashboardBuilder").component("modalComponent",{bindings:{resolve:"<",close:"&",dismiss:"&"},templateUrl:"/UIComponents/dashboardBuilder/javascript/components/myModalContent.html",controller:["$scope","dataService",function(a,b){var c=this;this.$onInit=function(){this.widget=this.resolve.widget,a.$broadcast("schemaFormRedraw"),this.frmGlobalOptions={destroyStrategy:"remove",formDefaults:{feedback:!1}},this.widget&&(this.widget.schema&&(this.schema=angular.copy(this.widget.schema)),this.widget.form&&(this.form=angular.copy(this.widget.form)),this.model=this.widget.options?angular.copy(this.widget.options):{},this.widget.onFormModelChange&&(this.frmGlobalOptions.formDefaults.onChange=this.widget.onFormModelChange))},a.loadDevicesCallback=function(a,b){return JSON.parse(window.localStorage.getItem("devices"))},a.loadDeviceSensorsCallback=function(a,b){var c=JSON.parse(window.localStorage.getItem("devices")),d=[];return _.map(c,function(a){var b=_.keys(a);_.forEach(b,function(b){d.push({value:b,name:b,device:a.id})})}),d},this.highlightTabs=function(a){var b=$('form[name="'+a+'"]'),c=b.find("ul li").not(".sub-tabs ul li"),d=b.find(".tab-pane").not(".sub-tabs .tab-pane")||[];b.find("ul li a span.badge").remove();for(var e=0;e<d.length;e++){var f=$(d[e]).find("div.ng-invalid").length;if(f>0){$(c[e].childNodes[0]).append('<span class="badge sf-badge-error">'+f+"</span>");for(var g=$(d[e]).find(".tab-pane"),h=$(d[e]).find("ul li"),e=0;e<g.length;e++){var f=$(g[e]).find("div.ng-invalid").length;f>0&&$(h[e].childNodes[0]).append('<span class="badge sf-badge-error">'+f+"</span>")}}}},this.onSubmit=function(b){a.$broadcast("schemaFormValidate"),console.log(this.model),setTimeout(function(){c.highlightTabs(b.$name)},100),b.$valid&&(this.close({$value:this.model}),console.log("component_form_parent",this.model))},this.onCancel=function(a){this.schema={},this.form={},this.model=angular.copy(this.widget.options),this.dismiss({$value:"cancel"}),console.log("Dissmissed")}}]}),angular.module("DashboardBuilder").component("sidetoolbar",{bindings:{},templateUrl:"/UIComponents/dashboardBuilder/javascript/components/sideToolbar.html",controller:["$scope","$mdSidenav",function(a,b){this.close=function(){b("left").close().then(function(){console.debug("close LEFT is done")})}}]}),angular.module("DashboardBuilder").component("confirmationModal",{bindings:{resolve:"<",close:"&",dismiss:"&"},templateUrl:"/UIComponents/dashboardBuilder/javascript/components/confirmation.html",controller:["$scope",function(a){this.$onInit=function(){this.data=this.resolve.data},this.onSubmit=function(){this.close({$value:!0})},this.onCancel=function(){this.dismiss({$value:!1})}}]}),angular.module("SearchBox",["angularBootstrapNavTree"]).component("scriptrSearchbox",{bindings:{treeControl:"<?",treeData:"<?",searchText:"@",iconLeaf:"@",paramName:"@",iconExpand:"@",iconCollapse:"@",onSelect:"<?",expandLevel:"@",initialSelection:"@",apiParams:"<?",loadTree:"<?",icon:"@",showFilter:"<?",treeSearchCriteria:"@",transport:"@",api:"@",onFormatData:"&"},templateUrl:"/UIComponents/dashboard/frontend/components/searchBox/searchBox.html",controller:["wsClient","httpClient",function(a,b){var c=this;this.iconExpand=this.iconExpand?this.iconExpand:null,this.$onInit=function(){this.iconLeaf=this.iconLeaf&&"$ctrl.iconLeaf"!=this.iconLeaf?this.iconLeaf:"icon-file  glyphicon glyphicon-file  fa fa-file",this.iconExpand=this.iconExpand&&"$ctrl.iconExpand"!=this.iconExpand?this.iconExpand:"icon-plus  glyphicon glyphicon-plus  fa fa-plus",this.iconCollapse=this.iconCollapse&&"$ctrl.iconCollapse"!=this.iconCollapse?this.iconCollapse:"icon-minus glyphicon glyphicon-minus fa fa-minus",this.paramName=this.paramName?this.paramName:"criteria",this.searchText=this.searchText?this.searchText:"Type to search",this.treeData=this.treeData?this.treeData:[],this.iconLeaf=this.iconLeaf?this.iconLeaf:null,this.transport=this.transport?this.transport:"wss",this.loadTree&&(this.searchValue=this.treeSearchCriteria,this.searching=!0,d(this.transport,this.searchValue))},this.onFilterChanged=function(){console.log("submit"),null!=this.searchValue&&""!=this.searchValue&&(this.searchValue=this.treeSearchCriteria,this.searching=!0,d(this.transport,this.searchValue))};var d=function(d,e){var f={};if(f[c.paramName]=e||c.treeSearchCriteria,c.apiParams)for(var g in c.apiParams)f[g]=c.apiParams[g];"wss"==d?a.onReady.then(function(){a.subscribe(c.msgTag,c.consumeData.bind(c)),c.api&&a.call(c.api,f,c.msgTag).then(function(a,b){c.consumeData(a)},function(a){console.log("reject published promise",a),c.consumeData()})}):"https"==d&&c.api&&b.get(c.api,f).then(function(a,b){c.consumeData(a)},function(a){c.consumeData(),console.log("reject published promise",a)})};this.consumeData=function(a,b){"function"==typeof c.onFormatData()&&(a=c.onFormatData()(a,c)),console.log("display tree"),"object"==typeof a&&a.length>0?(this.treeData=a,this.noResults=!1):(this.treeData=[],this.noResults=!0),this.searching=!1}}]}),angular.module("List",["angucomplete-alt","DataService"]).component("scriptrAutocomplete",{bindings:{id:"@",objects:"<?",hideObjects:"<?",listSelectedObject:"<?",defaultSetObject:"<?",placeholder:"@",maxlength:"@",pause:"@",selectedObject:"<?",selectedObjectData:"<?",titleField:"@",separator:"@",descriptionField:"@",imageField:"@",minlength:"@",inputName:"@",inputClass:"@",matchClass:"@",searchFields:"@",clearSelected:"@",overrideSuggestions:"@",fieldRequired:"@",fieldRequiredClass:"@",textSearching:"@",textNoResults:"@",initialValue:"@",inputChanged:"&",autoMatch:"@",focusIn:"&",focusOut:"&",disableInput:"@",focusFirst:"@",fieldTabindex:"@",parseInput:"&",localSearch:"&",transport:"@",api:"@",msgTag:"@",httpMethod:"@",apiParams:"<?",onFormatData:"&",fetchDataInterval:"@",useWindowParams:"@",serviceTag:"@",localData:"<?"},templateUrl:"/UIComponents/dashboard/frontend/components/list/autocomplete.html",controller:["$scope","dataService",function(a,b){var c=this;this.$onInit=function(){this.localData=this.localData?this.localData:[],this.fieldRequired=void 0!==this.fieldRequired&&this.fieldRequired,this.textSearching=void 0!==this.textSearching&&this.textSearching,this.transport=this.transport?this.transport:"wss",this.objects=this.objects?this.objects:[],this.listSelectedObject&&this.objects.length>0&&!c.api&&(a.$broadcast("angucomplete-alt:setData",c.id,this.localData),a.$broadcast("angucomplete-alt:setSelectedObjects",c.id,this.objects)),c.api&&(c.showList=!1,d(this.transport))},c.addObjectToList=function(b){a.$broadcast("angucomplete-alt:addObjectToList",c.id,b),0==this.objects.length&&void 0!==this.defaultSetObject&&(this.objects=JSON.parse(JSON.stringify(this.defaultSetObject)))};var d=function(e){var f={api:c.api,transport:e,msgTag:c.msgTag,apiParams:c.apiParams,useWindowParams:c.useWindowParams,httpMethod:c.httpMethod,widgetId:a.$id};b.scriptrRequest(f,c.consumeData.bind(c)),c.fetchDataInterval&&!c.refreshTimer&&(c.refreshTimer=$interval(function(){d(c.transport)},1e3*c.fetchDataInterval))};c.consumeData=function(b,d){c.showList=!0,"function"==typeof c.onFormatData()&&(b=c.onFormatData()(b,c)),c.localData=b,c.listSelectedObject&&c.objects.length>0&&(a.$broadcast("angucomplete-alt:setData",c.id,c.localData),a.$broadcast("angucomplete-alt:setSelectedObjects",c.id,c.objects))}}]});